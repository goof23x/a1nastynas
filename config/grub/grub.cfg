# A1NAS Custom GRUB Configuration
# Professional branding with multiple boot options

# Basic GRUB settings
set timeout=30
set default=0
set fallback=1

# Terminal and display settings
terminal_output console
if [ "${grub_platform}" = "efi" ]; then
    set gfxmode=auto
    set gfxpayload=keep
else
    set gfxmode=1024x768x32,1024x768x24,1024x768x16,auto
fi

# Load modules
insmod all_video
insmod gfxterm
insmod png
insmod jpeg
insmod part_gpt
insmod part_msdos
insmod iso9660
insmod loopback
insmod search
insmod search_fs_file
insmod search_fs_uuid

# Enable graphics terminal
if loadfont /boot/grub/fonts/unicode.pf2; then
    set gfxterm_font=unicode
    terminal_output gfxterm
fi

# Set background image if available
if [ -f /boot/grub/themes/a1nas/background.png ]; then
    insmod png
    background_image /boot/grub/themes/a1nas/background.png
fi

# Custom theme
if [ -f /boot/grub/themes/a1nas/theme.txt ]; then
    set theme=/boot/grub/themes/a1nas/theme.txt
fi

# Custom colors
set color_normal=cyan/black
set color_highlight=white/blue

# A1NAS ASCII Art Header
echo -e "\033[0;36m"
echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
echo "â•‘     â–„â–€â–ˆ â–„â–ˆ â–ˆâ–„ â–ˆ â–„â–€â–ˆ â–ˆâ–€   â–ˆâ–„ â–ˆ â–ˆâ–ˆâ–€ â–€â–ˆâ–€ â–ˆ â–ˆ â–ˆ â–ˆâ–€â–ˆ â–ˆâ–€â–ˆ â–ˆâ–„â–€        â•‘"
echo "â•‘     â–ˆâ–„â–ˆ â–€â–ˆ â–ˆâ–€â–„â–ˆ â–ˆâ–„â–ˆ â–„â–ˆ   â–ˆâ–€â–„â–ˆ â–ˆâ–ˆâ–„  â–ˆ  â–€â–„â–€â–„â–€ â–ˆâ–„â–ˆ â–ˆâ–€â–„ â–ˆ â–ˆ        â•‘"
echo "â•‘                                                                  â•‘"
echo "â•‘           ğŸš€ A1NAS - NETWORK ATTACHED STORAGE OS ğŸš€             â•‘"
echo "â•‘                      Professional Edition                       â•‘"
echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo -e "\033[0m"

# Menu entries
menuentry "ğŸš€ A1NAS OS - Live Mode (Default)" --class a1nas --class gnu-linux --class gnu --class os {
    set gfxpayload=keep
    echo "ğŸ”„ Loading A1NAS Live System..."
    echo "   â¤ Kernel: Loading Linux kernel..."
    linux /boot/vmlinuz boot=live components quiet splash toram live-media-path=/live
    echo "   â¤ InitRD: Loading initial ramdisk..."
    initrd /boot/initrd
    echo "   â¤ Ready! Booting A1NAS..."
}

menuentry "âš¡ A1NAS OS - Performance Mode" --class a1nas --class gnu-linux --class gnu --class os {
    set gfxpayload=keep
    echo "âš¡ Loading A1NAS Performance Mode..."
    echo "   â¤ Optimized for maximum performance"
    linux /boot/vmlinuz boot=live components toram live-media-path=/live acpi_osi=Linux pcie_aspm=off processor.max_cstate=1 intel_idle.max_cstate=0 idle=poll
    initrd /boot/initrd
}

menuentry "ğŸ”§ A1NAS OS - Debug Mode" --class a1nas --class gnu-linux --class gnu --class os {
    set gfxpayload=keep
    echo "ğŸ”§ Loading A1NAS Debug Mode..."
    echo "   â¤ Verbose logging enabled"
    linux /boot/vmlinuz boot=live components live-media-path=/live debug systemd.log_level=debug systemd.log_target=console console=tty0 console=ttyS0,115200n8
    initrd /boot/initrd
}

menuentry "ğŸ›¡ï¸ A1NAS OS - Safe Mode" --class a1nas --class gnu-linux --class gnu --class os {
    set gfxpayload=keep
    echo "ğŸ›¡ï¸ Loading A1NAS Safe Mode..."
    echo "   â¤ Minimal drivers and safe configuration"
    linux /boot/vmlinuz boot=live components quiet live-media-path=/live nomodeset acpi=off noapic nosmp
    initrd /boot/initrd
}

menuentry "ğŸ’¾ A1NAS OS - Persistent Storage" --class a1nas --class gnu-linux --class gnu --class os {
    set gfxpayload=keep
    echo "ğŸ’¾ Loading A1NAS with Persistent Storage..."
    echo "   â¤ Looking for persistence volume..."
    linux /boot/vmlinuz boot=live components quiet splash live-media-path=/live persistence
    initrd /boot/initrd
}

menuentry "ğŸ§° A1NAS OS - Recovery Mode" --class a1nas --class gnu-linux --class gnu --class os {
    set gfxpayload=keep
    echo "ğŸ§° Loading A1NAS Recovery Mode..."
    echo "   â¤ Single user mode for system recovery"
    linux /boot/vmlinuz boot=live components live-media-path=/live single init=/bin/bash
    initrd /boot/initrd
}

submenu "ğŸ”¬ Advanced Options" --class submenu {
    menuentry "ğŸ’» A1NAS OS - Text Mode Only" --class a1nas {
        echo "ğŸ’» Loading A1NAS Text Mode..."
        linux /boot/vmlinuz boot=live components live-media-path=/live text systemd.unit=multi-user.target
        initrd /boot/initrd
    }
    
    menuentry "ğŸŒ A1NAS OS - Network Boot Check" --class a1nas {
        echo "ğŸŒ Loading A1NAS with Network Diagnostics..."
        linux /boot/vmlinuz boot=live components live-media-path=/live netboot
        initrd /boot/initrd
    }
    
    menuentry "ğŸ” Memory Test (Memtest86+)" --class memtest {
        echo "ğŸ” Starting Memory Test..."
        if [ -f /boot/memtest86+.bin ]; then
            linux16 /boot/memtest86+.bin
        else
            echo "âŒ Memtest86+ not found"
            sleep 3
        fi
    }
}

submenu "ğŸ› ï¸ System Tools" --class submenu {
    menuentry "ğŸ”§ Hardware Detection Test" --class tool {
        echo "ğŸ”§ Loading Hardware Detection..."
        linux /boot/vmlinuz boot=live components live-media-path=/live hwdetect
        initrd /boot/initrd
    }
    
    menuentry "ğŸ’½ Disk Utility Mode" --class tool {
        echo "ğŸ’½ Loading Disk Utilities..."
        linux /boot/vmlinuz boot=live components live-media-path=/live disk-utility
        initrd /boot/initrd
    }
}

menuentry "ğŸ”„ Reboot System" --class reboot {
    echo "ğŸ”„ Rebooting system..."
    reboot
}

menuentry "âš¡ Shutdown System" --class shutdown {
    echo "âš¡ Shutting down system..."
    halt
}

# Help text
menuentry "â“ Boot Help & Information" --class help {
    echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
    echo "â•‘                        A1NAS Boot Help                          â•‘"
    echo "â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£"
    echo "â•‘ ğŸš€ Live Mode:        Standard boot with full desktop            â•‘"
    echo "â•‘ âš¡ Performance:      Optimized for high-performance workloads   â•‘"
    echo "â•‘ ğŸ”§ Debug Mode:       Verbose logging for troubleshooting        â•‘"
    echo "â•‘ ğŸ›¡ï¸ Safe Mode:        Minimal drivers for compatibility          â•‘"
    echo "â•‘ ğŸ’¾ Persistent:       Saves changes to USB/disk                  â•‘"
    echo "â•‘ ğŸ§° Recovery:         Single-user mode for system repair         â•‘"
    echo "â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£"
    echo "â•‘ For more information: https://github.com/yourusername/a1nas     â•‘"
    echo "â•‘ Support: support@a1nas.com                                      â•‘"
    echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
    echo ""
    echo "Press any key to return to boot menu..."
    read
}

# Boot parameter explanations for advanced users
if [ "${grub_platform}" = "pc" ]; then
    # BIOS-specific settings
    set root='(cd)'
    search --no-floppy --set=root --file /boot/vmlinuz
else
    # UEFI-specific settings
    search --no-floppy --set=root --file /boot/vmlinuz
fi

# Automatic boot countdown with styled message
echo ""
echo -e "\033[1;33mâ±ï¸  A1NAS will boot automatically in ${timeout} seconds...\033[0m"
echo -e "\033[0;36mğŸ’¡ Press any key to access the boot menu\033[0m"
echo -e "\033[0;32mğŸš€ Welcome to A1NAS - The Future of Network Storage!\033[0m"